8年！我在OpenStack路上走过的坑。。。 

http://www.sohu.com/a/254076808_610730
其主要特征如下：

计算：支持KVM、ESXi 和裸金属服务器等三个资源池。
网络：采用 Neutron + VLAN + OVS 实现了虚拟网络。
存储：采用 Ceph 和 SAN 实现了块存储，采用Ceph实现了对象存储。
区：在两个城市三个机房部署了3个区域，每个区域内划分资源池，资源池内再按机架划分可用区。三个层级都用户都可见，可按需选择。另外，我们还尝试搞过一个小型公有云区域。
功能：利用了Mitaka版本中的Glance/Nova/Neutron/Cinder/Keystone/Heat/Telemetry/OVSvAPP/Trove/Ironic等组件。
管理：采用自研云管理平台管理多个区域。
容器云平台：基于Kubernetes的容器云平台运行在自己管理的物理机上。
团队：最多时候8个人的OpenStack研发团队，3个人的运维团队。

一些感受：

总得来说运行的还蛮好，我们在技术和产品选型、研发、运维等方面都做得不错，团队非常给力，研发周期较短，迭代快速。现在它支撑着集团大大小小几百套系统，而且很稳定，运维压力已经比较小了。在此，我也要感谢并肩战斗过的小伙伴们。
也出现过一些稳定性问题：比如Neutron VR 偶尔会自动切换（我们还有一个小型公有云环境，采用Neutron + VR + OVS 架构）；KVM虚拟机偶尔自动重启甚至宕机等；KVM对windows的支持比较差，偶尔出现莫名其妙的问题，比如磁盘脱机、蓝屏、无法启动等。
监控组件、日志组件很不健全，都需要我们自己大改或者从零搭建。
除了核心模块，其它模块几乎都是半拉子工程。以Trove 为例，我们花了不少时间，几乎重写了一半的代码，也就实现了最基本的数据库实例的创建和管理功能。
OpenStack 离公有云需求的差距实在太远。


企业私有云环境中，VMware 是真正的老大。因此，OpenStack这要做私有云的目标，说好听点，要向 VMware学习；说难听点，就是要替代掉VMware。而 VMware vSphere 提供的只是虚拟化环境，因此 OpenStack 对标的对象我认为应该是 『VMware的 虚拟化功能』+『AWS的 Cloud 功能，主要是云API』。但是，因为一开始 OpenStack 对标的是 AWS，而AWS 是公有云不是私有云，这就导致了后来很多问题的出现，下文会仔细道来。

『VMware 虚拟化』+『AWS Cloud 功能』这两部分中，因为一开始OpenStack 就是对标AWS的，因此 『Cloud』部分应该说做得还是很不错的，或者说克隆的不错。这从用户调查的『为什么组织会选择OpenStack？』部分的答案中也能看出来，即开放平台和API的标准化是第一业务驱动力。

VMware 功能	描述	相应的OpenStack功能
vMotion	可以使运行中的虚拟机从一台物理服务器实时迁移到另一台物理服务器，它实现了零停机时间和连续可用的服务。vSphere 6.0 支持跨数据中心的vMotion。	可以利用 KVM live migration 功能实现虚拟的实时迁移，但是需要结合第三方工具。
DRS（分布式资源调度）	跨资源池不间断地监控利用率，并根据反映业务需要和不断变化的优先级的预定义规则，在多台虚拟机之间智能地分配可用资源。	不支持。
分布式电源管理（DPM）	DPM提供了通过动态调整群集容量来匹配虚拟机资源需求，以达到节省电力的目的，DPM自动整合虚拟机到较少的ESXi主机上，并对一定周期内资源利用率低的多于ESXi主机执行断电，如果资源需求增加，ESXi主机重新通电回到群集，虚拟机重新分配到群集内所有可用的ESXI主机上。	不支持。
HA	持续监控资源池中的所有物理服务器，并重启受服务器故障影响的虚拟机。还可以监控和检测虚拟机的“客户操作系统”故障，并在用户指定的间隔后自动启动虚拟机	不支持。
FT	通过创建和维护等同于主虚拟机并可在发生故障切换时替换主虚拟机的辅助虚拟机来为虚拟机提供连续可用性	不支持。
vShield	VMware 安全虚拟设备套件	Neutron 的安全组和防火墙实现了 vShield 的部分功能
vDS（分布式虚拟交换机）	让用户可以从一个集中界面为整个数据中心设置虚拟机访问交换，从而简化虚拟机网络连接。	Neutron 利用 OVS 实现了部分功能
Storage API		Cinder
SRM	站点灾难恢复	有Freezer 项目，但尚不足以进入生产环境。

不管是对比VMware 还是对比AWS，OpenStack核心服务的范围都太小了，导致它缺乏了一些必要的功能。我认为至少以下几个服务需要进入核心服务列表：
编排服务Heat：编排服务是云的基础性服务之一。一来用户可以通过编排服务自行创建和销毁云资源，二来很多二级服务可以通过提供编排模版的方式来提供给用户，三来可以与第三方云管平台和工具对接，从而培育其生态。
监控服务Ceilometer：一个云生产环境离不开一个强壮的监控服务。到目前为止，Ceilometer 项目都还问题重重，比如规模性问题、性能问题、功能覆盖问题等。
裸机服务 Ironic：裸机在私有云中有很多的应用场景，比如运行数据库、大数据平台、容器平台等。如果OpenStack把Ironic做好了，那这就会成为与VMware相比的一大优势，同时还能成为一些需要利用裸机的应用的支撑平台。现在的Ironic项目，实在太重太复杂，与物理网络设备关联太深。但是，如果可以像LINUX的kickstart和cobbler一样，就灵活轻量多了，这个过程比如像vmware里物理机可以批量部署ESXI，然后把ESXI纳管进来，就可以使用VC里的所有服务，这样的过程就比较合理了。
日志服务：同监控服务一样，日志服务也是云平台的一个基础性服务，如同AWS 的CloudWatch和所有项目都打通了一样。遗憾的是，到现在为止，OpenStack都没有一个原生的日志服务项目。
部署服务：部署对私有云很重要。OpenStack需要一个提供象 Mirantis Fuel 这样的图形化一键部署工具的核心服务。
OpenStack社区把过多精力耗费在了一些看起来很有前途，但实际上却比较鸡肋的服务项目中，比如容器服务Magnum、大数据服务 Sahara、数据库服务 Trove、容器化部署服务Kolla。好吧，我晓得你可能有不同的看法，我不想争论，还是来看用户调查报告中的数据吧。
一方面，用户对这些项目很感兴趣。我认为至少有三个原因，一来是人们对新事物都有好奇心，二来是OpenStack社区的大力宣扬，三是殷切期望。下面的数据来自201704 用户调查报告：

（备注：图中的数字是百分比）

那到底是什么原因导致这些新服务叫好不叫座呢？我认为有几个原因：
（1）私有云和公有云对云平台需求的差异。

下图是一个我认为比较典型的私有云环境：

它具有几个特点：

只有底层的物理机管理系统是统一的，而上面的多个平台是分离的。而公有云上，云平台是统一的。
平台是分离的。这可能有几个原因，一是管理因素，每个平台往往由不同部门在管理和使用；二是运维因素，把平台都放在一起，运维团队搞不定这个单体平台的运维，必须分而治之；三是技术因素，私有云领域还没出现象AWS和阿里云这种能把这几个平台纳管在一起的统一云平台；四是在某些企业里限于等保和安全的需要，某个大业务需要独占资源池。
除了基础云平台是在虚拟机级别实现多租户外，其它平台往往只是在管理平台层面实现了多租户，或者业务层面自己实现了多租户，而下面是一个或几个大的资源池。

我对OpenStack的感情

我对OpenStack有着挺深的感情。是它，让我认识了什么是云，云是怎么构建的、是如何运行的、是如何维护的等等。是从研究它开始，我开始从传统软件领域进入了云领域，我也开始了写博客的漫漫历程，也通过它结识了很多朋友。因此，当看到有人故意诋毁它，甚至对它落井下石时，心里很不是滋味。其实，我觉得不光是我，整个IT领域都应该感谢OpenStack，它的出现大大加速了IT架构演进进程。

前面的内容，也许喷的成分居多，但是，请理解我的心情，因为本来OpenStakc是可以发展得更好的，毕竟它曾经拥有过多么好的天时、地利和人和啊。从实际情况来看，如果企业有一个OpenStack研发团队，或者找了一个靠谱的外部供应商，而且规模不是特别大，业务不是那么复杂，还有几个给力的运维，OpenStack私有云还是可以跑得挺好的。至少在国内，OpenStack已经成为了自主可控的私有云云平台的主要代表之一，在各行各业发光发热。

不管它的结局如何，OpenStack都将在IT发展史上留下了浓墨重彩的一笔。在此，我想感谢OpenStack项目、感谢OpenStack每一行代码和每一个文档、OpenStack社区，和所有给OpenStack做过贡献的公司和人们。

作者介绍：

刘世民（Sammy Liu），云爱好者和从业者，『世民谈云计算』微信公众号和技术博